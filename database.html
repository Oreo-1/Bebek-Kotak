<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bebek Kotak - Top 100 Leaderboard</title>
    <link rel="stylesheet" type="text/css" href="pottaone.css" />
    <style>
        body {
            background-color: #DCEDC8;
            font-family: 'Potta One', cursive;
            color: #5D4037;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #FF7043;
            text-shadow: 3px 3px 0 #FFF;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .table-container {
            width: 100%;
            max-width: 850px;
            background: white;
            border: 6px solid #5D4037;
            border-radius: 30px;
            overflow: hidden;
            box-shadow: 0 12px 0 #5D4037;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #FFF;
        }

        th {
            background-color: #AED581;
            padding: 15px;
            border-bottom: 4px solid #5D4037;
            font-size: 1.1rem;
            text-transform: uppercase;
        }

        td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 2px solid #DCEDC8;
            font-size: 1rem;
        }

        tr:nth-child(even) {
            background-color: #F1F8E9;
        }

        tr:hover {
            background-color: #E8F5E9;
        }

        .rank-1 { color: #FFD700; font-size: 1.4rem; font-weight: bold; }
        .rank-2 { color: #9E9E9E; font-size: 1.2rem; font-weight: bold; }
        .rank-3 { color: #CD7F32; font-size: 1.1rem; font-weight: bold; }

        .loading-text {
            margin-top: 50px;
            font-size: 1.5rem;
            animation: blink 1s infinite;
        }

        .empty-text {
            margin-top: 50px;
            font-size: 1.2rem;
            color: #888;
        }

        @keyframes blink { 50% { opacity: 0.5; } }

        .back-btn {
            margin-top: 30px;
            background: #FFAB91;
            border: 4px solid #5D4037;
            padding: 10px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Potta One';
            font-size: 1rem;
            box-shadow: 0 5px 0 #5D4037;
            text-decoration: none;
            color: #5D4037;
        }
        .back-btn:active { transform: translateY(4px); box-shadow: 0 0 0 #5D4037; }
    </style>
</head>

<body>

    <h1>üèÜ TOP 100 LEADERBOARD</h1>

    <div id="status-msg" class="loading-text">LOADING DATA...</div>

    <div class="table-container" id="content" style="display: none;">
        <table>
            <thead>
                <tr>
                    <th>RANK</th>
                    <th>NAME</th>
                    <th>SCORE</th>
                    <th>WPM</th>
                    <th>ACC</th>
                    <th>TIME</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                <!-- Data will be injected here -->
            </tbody>
        </table>
    </div>

    <a href="index.html" class="back-btn">BACK TO GAME</a>

    <script>
        /**
         * Format playtime to MM:SS
         */
        function formatPlaytime(timeValue) {
            if (typeof timeValue === 'string' && timeValue.includes(':')) return timeValue;
            const secs = parseInt(timeValue) || 0;
            const m = Math.floor(secs / 60).toString().padStart(2, '0');
            const s = (secs % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        /**
         * Load data from database.txt via Electron API
         */
        function loadLeaderboard() {
            const statusMsg = document.getElementById('status-msg');
            const content = document.getElementById('content');
            const tbody = document.getElementById('leaderboard-body');

            try {
                // 1. Check if API exists
                if (!window.electronAPI) {
                    throw new Error("Electron API not found");
                }

                // 2. Read data
                const rawData = window.electronAPI.readDB();
                const data = JSON.parse(rawData || "[]");

                if (data.length === 0) {
                    statusMsg.innerText = "NO DATA AVAILABLE YET";
                    statusMsg.classList.remove('loading-text');
                    statusMsg.classList.add('empty-text');
                    return;
                }

                // 3. Sort data (Score > WPM > Accuracy) just in case
                data.sort((a, b) => {
                    if (b.score !== a.score) return b.score - a.score;
                    if (b.wpm !== a.wpm) return b.wpm - a.wpm;
                    return b.accuracy - a.accuracy;
                });

                // 4. Render Table
                tbody.innerHTML = '';
                data.forEach((player, index) => {
                    const row = document.createElement('tr');
                    const rank = index + 1;

                    let rankClass = "";
                    if (rank === 1) rankClass = "rank-1";
                    else if (rank === 2) rankClass = "rank-2";
                    else if (rank === 3) rankClass = "rank-3";

                    row.innerHTML = `
                        <td class="${rankClass}">${rank}</td>
                        <td>${player.name}</td>
                        <td><strong>${player.score.toLocaleString()}</strong></td>
                        <td>${player.wpm}</td>
                        <td>${player.accuracy}%</td>
                        <td>${formatPlaytime(player.playtime)}</td>
                    `;
                    tbody.appendChild(row);
                });

                // 5. Show Content
                statusMsg.style.display = 'none';
                content.style.display = 'block';

            } catch (error) {
                console.error("Failed to load leaderboard:", error);
                statusMsg.innerText = "FAILED TO LOAD DATABASE üò≠";
                statusMsg.classList.remove('loading-text');
            }
        }

        // Run on load
        window.onload = loadLeaderboard;
    </script>
</body>

</html>