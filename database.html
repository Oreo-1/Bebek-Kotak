<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ducktype Leaderboard ‚ú®</title>
    <link href="https://fonts.googleapis.com/css2?family=Potta+One&display=swap" rel="stylesheet">
    <style>
        /* ... (CSS SAMA SEPERTI SEBELUMNYA) ... */
        :root { --bg-color: #fff0f5; --primary: #FFAB91; --secondary: #DCEDC8; --text: #5D4037; --gold: #FFD54F; --silver: #E0E0E0; --bronze: #A1887F; }
        body { font-family: 'Potta One', cursive; background-color: var(--bg-color); background-image: radial-gradient(#FFCCBC 2px, transparent 2px); background-size: 25px 25px; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: var(--text); }
        .container { background: #FFF; width: 100%; max-width: 700px; padding: 2rem; border-radius: 30px; box-shadow: 0 10px 0 #5D4037; text-align: center; border: 6px solid #5D4037; }
        h1 { color: #FF7043; font-size: 2.5rem; margin: 0; text-shadow: 3px 3px 0 #FFF; margin-bottom: 5px; }
        p.subtitle { color: #90A4AE; margin-top: 0; margin-bottom: 25px; }
        .table-container { overflow-x: auto; border-radius: 20px; border: 4px solid var(--secondary); background: #fff; max-height: 500px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; white-space: nowrap; }
        thead { background-color: var(--secondary); position: sticky; top: 0; z-index: 10; }
        th { padding: 15px; color: #5D4037; font-size: 1.1rem; text-transform: uppercase; }
        td { padding: 12px 15px; border-bottom: 2px solid #f0f0f0; font-size: 1rem; }
        tr:nth-child(even) { background-color: #FAFAFA; }
        tr:hover { background-color: #FFF3E0; }
        .rank-badge { display: inline-flex; justify-content: center; align-items: center; width: 35px; height: 35px; border-radius: 50%; background: #eee; color: #555; box-shadow: 0 3px 0 rgba(0,0,0,0.2); }
        tr:nth-child(1) .rank-badge { background: var(--gold); color: #FFF; }
        tr:nth-child(2) .rank-badge { background: var(--silver); color: #FFF; }
        tr:nth-child(3) .rank-badge { background: var(--bronze); color: #FFF; }
        .score-text { color: #FF7043; }
        .date-text { font-size: 0.8rem; color: #999; font-family: sans-serif; }
        .btn-refresh { margin-top: 25px; background-color: var(--primary); color: #5D4037; border: 4px solid #5D4037; padding: 12px 35px; font-size: 1.2rem; border-radius: 50px; cursor: pointer; font-family: 'Potta One', cursive; box-shadow: 0 6px 0 #5D4037; transition: all 0.1s; }
        .btn-refresh:active { transform: translateY(6px); box-shadow: 0 0 0 #5D4037; }
        .loading { font-size: 1.2rem; color: #aaa; padding: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üèÜ TOP 100</h1>
        <p class="subtitle">Ducktype Hall of Fame</p>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th width="10%">#</th>
                        <th width="35%" style="text-align: left; padding-left: 20px;">Name</th>
                        <th width="25%">Score</th>
                        <th width="30%">Date</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <tr><td colspan="4" class="loading">Loading data... ü¶Ü</td></tr>
                </tbody>
            </table>
        </div>

        <button class="btn-refresh" onclick="refreshLeaderboard()">
            üîÑ Refresh
        </button>
    </div>

    <script src="database.js"></script>

    <script>
        async function refreshLeaderboard() {
            const tableBody = document.getElementById('leaderboard-body');
            tableBody.innerHTML = `<tr><td colspan="4" class="loading">Fetching... ü¶Ü</td></tr>`;

            try {
                // 1. Ambil Data
                let data = await getDatabase();

                if (!data || data.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="4" style="padding: 30px; color: #aaa;">Belum ada data skor üò¢</td></tr>`;
                    return;
                }

                // 2. SORTING OTOMATIS (Client Side)
                // Memastikan data urut dari skor terbesar ke terkecil
                data.sort((a, b) => b.score - a.score);

                // 3. Render
                let html = "";
                data.forEach((player, index) => {
                    // Rank dihitung dari index loop (0 jadi 1, dst)
                    let rank = index + 1;
                    let dateDisplay = player.datetime || "-";

                    html += `
                        <tr>
                            <td><div class="rank-badge">${rank}</div></td>
                            <td style="text-align: left; padding-left: 20px;">${player.name}</td>
                            <td class="score-text">${player.score}</td>
                            <td class="date-text">${dateDisplay}</td>
                        </tr>
                    `;
                });

                tableBody.innerHTML = html;

            } catch (error) {
                console.error(error);
                tableBody.innerHTML = `<tr><td colspan="4" style="color: red;">Gagal memuat data.</td></tr>`;
            }
        }

        document.addEventListener('DOMContentLoaded', refreshLeaderboard);
    </script>
</body>
</html>